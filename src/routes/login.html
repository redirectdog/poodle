<svelte:head>
	<title>Login</title>
</svelte:head>

<RDPage>
	<h2>Login</h2>
	<form on:submit|preventDefault="submit()">
		<div>
			<input type="text" bind:value=email />
		</div>
		<div>
			<input type="password" bind:value=password />
		</div>
		<button type="submit">Login</button>
	</form>
</RDPage>

<script>
	export default {
		components: {
			RDPage: "../components/RDPage.html",
		},
		data: () => ({email: "", password: ""}),
		methods: {
			submit() {
				const { email, password } = this.get();
				fetch(
					"/api/logins",
					{
						method: "POST",
						body: JSON.stringify({email, password}),
						headers: {"Content-Type": "application/json"},
					},
				)
					.then(res => res.text())
					.then(res => {
						console.log("result is", res);
						document.cookie = "poodleToken=" + res + ";path=/";
						fetch("/api/users/~me")
							.then(res => res.json())
							.then(res => this.store.set({USER: res}));
					});
			}
		}
	}
</script>
