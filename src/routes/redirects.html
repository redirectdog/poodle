<svelte:head>
	<title>My Redirects</title>
</svelte:head>

<RDPage>
	<a class="button" href="/newRedirect">New</a>
	<table>
		<tr>
			<th>Redirect</th>
			<th>Total Visits</th>
			<th>Visits in the Last Month</th>
		</tr>
		{#each data as redirect}
		<tr>
			<td>
				{redirect.host} -&gt; {redirect.destination}
			</td>
			<td>{redirect.visits_total}</td>
			<td>{redirect.visits_month}</td>
		</tr>
		{/each}
	</table>
</RDPage>

<script>
	import fetchWithError from "../util/fetchWithError";
	import showError from "../util/showError";

	export default {
		components: {
			RDPage: "../components/RDPage.html",
		},
		preload() {
			return this.fetch("/api/users/~me/redirects", {credentials: "include"})
				.then(res => res.json())
				.then(res => {
					return {data: res};
				});
		}
	}
</script>
